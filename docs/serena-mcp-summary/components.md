# Components 分析

日時: 2025-10-09

このファイルは `docs/serena-mcp-summary/overview.md` から切り出した `src/components` に関する詳細分析です。

## 構造の概観

- `avatar/` - アバター関連（`avatar.tsx`）
- `document/` - ドキュメント表示に関する小コンポーネント群（絵文字、リスト、スケルトン）
- `footer/`, `nav-bar/`, `page-header/` - レイアウト・ナビ関連の単位コンポーネント
- `layout/` - レイアウトユーティリティ（`container`, `flex-col`, `flex-row`）
- `link/`, `tag/`, `paragraph/`, `sns-list/` - 再利用 UI 要素
- `opengraph-image/` - OG 画像生成コンポーネント
- `pagination/`, `ui/` - 汎用 UI（ボタン、入力、セレクト、トグル等）
- `theme-switcher/` - テーマ切替 UI

全体的にコンポーネントは小さく、責務が分離されており、Next.js の App Router 構成に適した整理がされている印象です。

## 観察された良い点

- コンポーネント分割が明確で、再利用性を意識した命名規則が統一されている。
- `ui/` に共通 UI が集約されており、デザイン一貫性を保ちやすい構成。
- レイアウト系（`layout/`）が独立しており、ページごとのレイアウト差分を吸収しやすい。
- `document/` にスケルトンやリストがあるため、ロード時の UX に配慮されている。

## 改善の余地 / リスク

1. ドキュメント・テスト不足（中）
   - 主要コンポーネント（`nav-bar`, `footer`, `ui/button`, `document-list` など）に対するユニットテストやスナップショットが見当たらない。見た目や振る舞いの回帰を防ぐためにテスト追加を推奨します。

2. 型と Prop バリデーション（低〜中）
   - TypeScript を利用しているが、public コンポーネントの Props 型やドキュメント（Props の説明）が一部で不足している可能性あり。`ui` の共通コンポーネントには明確な Props 型とデフォルト値（必要なら）を付与すると堅牢性が増します。

3. CSS スコープとスタイルの一貫性（低）
   - グローバル CSS とモジュール CSS が混在している様子。`components` 側のスタイルが他と衝突しないよう、CSS Modules / Tailwind コンポーネント設計ルールをドキュメント化すると良いです。

4. アクセシビリティ（低）
   - ボタン、リンク、入力周りでアクセシビリティ（aria 属性、ラベル、キーボード操作）が適切に扱われているかの簡易チェックを推奨します。

## 短期的推奨アクション

- `nav-bar/nav-bar.tsx`, `footer/footer.tsx`, `document/document-list.tsx` に対する React Testing Library を使った 1~2 個のユニットテストを追加（レンダリング + 主要振る舞いの検証）。
- 共通 UI の Props 型定義を見直し、必要ならドキュメント（README の短いセクション）を追加。
- スタイルルールの簡単なガイド（Tailwind または CSS Modules の使い分け）をプロジェクト README に追記。

注: `src/components/ui` 以下のコンポーネントは `shadcn/ui` 由来で生成されたパターンが多く見られるため、これらに対する修正や改善タスクは優先度を低めに扱って構いません（低リスク・低還元）。

## 中長期的推奨アクション

- コンポーネントごとに Storybook を導入して視覚的な回帰検知とドキュメンテーションを行う。
- アクセシビリティ監査（Axe 等）と CI 統合を行い、主要なアクセシビリティ問題を自動検出する。

## ui/ に対する CI / テストの優先度（明示）

注: `src/components/ui` 配下は shadcn/ui 由来のコンポーネントが多く、プロジェクト固有のロジックが少ないため、CI やテストの優先度は低めに設定することを推奨します。具体的な扱い方の例:

- CI での厳格なユニットテストを必須から推奨へ緩和し、ブロック条件から除外する（例: `ui/` の変更は軽度なチェックのみ通す）。
- `ui/` の静的型チェック（TypeScript の型チェック）は継続して実行するが、視覚回帰や細かなアクセシビリティチェックは主要コンポーネントに限定して実行する。
- 重大な UI 不具合が疑われる場合のみ `ui/` の Storybook スナップショットや E2E を追加して検証する運用にする。

こうすることで、CI のフィードバックコストを下げつつ、コア機能とドメイン固有のコンポーネントに改善リソースを集中できます。
